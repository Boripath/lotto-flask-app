<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏û‡∏¢‡∏´‡∏ß‡∏¢‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="lotto-container">
    <!-- ‚úÖ ‡∏•‡∏ö‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß -->

    <!-- ‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏ô‡∏¥‡∏î‡∏´‡∏ß‡∏¢ -->
    <form method="POST" class="form-grid">
        <label>‡∏ä‡∏ô‡∏¥‡∏î‡∏´‡∏ß‡∏¢:</label>
        <select name="lottery_type" onchange="this.form.submit()">
            {% for ltype in ["‡∏´‡∏ß‡∏¢‡∏£‡∏±‡∏ê‡∏ö‡∏≤‡∏•‡πÑ‡∏ó‡∏¢", "‡∏´‡∏ß‡∏¢‡∏•‡∏≤‡∏ß‡∏û‡∏±‡∏í‡∏ô‡∏≤ (‡∏à,‡∏û,‡∏®)", "‡∏´‡∏ß‡∏¢‡∏Æ‡∏≤‡∏ô‡∏≠‡∏¢ ‡∏û‡∏¥‡πÄ‡∏®‡∏©", "‡∏´‡∏ß‡∏¢‡∏Æ‡∏≤‡∏ô‡∏≠‡∏¢", "‡∏´‡∏ß‡∏¢‡∏Æ‡∏≤‡∏ô‡∏≠‡∏¢ VIP"] %}
                <option value="{{ ltype }}" {% if session.lottery_type == ltype %}selected{% endif %}>{{ ltype }}</option>
            {% endfor %}
        </select>
        <input type="hidden" name="action" value="set_lottery_type">
    </form>

    <!-- ‚úÖ ‡∏á‡∏ß‡∏î + countdown + ‡∏ò‡∏á‡∏ä‡∏≤‡∏ï‡∏¥ -->
    <div class="draw-info-box">
        {% if session.lottery_type == "‡∏´‡∏ß‡∏¢‡∏£‡∏±‡∏ê‡∏ö‡∏≤‡∏•‡πÑ‡∏ó‡∏¢" %}
            <img src="https://flagcdn.com/th.svg" width="25" style="margin-right:6px;">
        {% elif session.lottery_type == "‡∏´‡∏ß‡∏¢‡∏•‡∏≤‡∏ß‡∏û‡∏±‡∏í‡∏ô‡∏≤ (‡∏à,‡∏û,‡∏®)" %}
            <img src="https://flagcdn.com/la.svg" width="25" style="margin-right:6px;">
        {% elif "‡∏´‡∏ß‡∏¢‡∏Æ‡∏≤‡∏ô‡∏≠‡∏¢" in session.lottery_type %}
            <img src="https://flagcdn.com/vn.svg" width="25" style="margin-right:6px;">
        {% endif %}
        <b>{{ draw_info }}</b> |
        <span id="countdown" style="color:red;">{{ countdown }}</span>
    </div>

    <!-- ‚úÖ ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏à‡πà‡∏≤‡∏¢ -->
    <form method="POST" class="disable-on-close">
        <label>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏à‡πà‡∏≤‡∏¢:</label>
        <label class="radio-label">
            <input type="radio" name="pricerate" value="70" onchange="this.form.submit()" {% if pricerate == 70 %}checked{% endif %}>70
        </label>
        <label class="radio-label">
            <input type="radio" name="pricerate" value="90" onchange="this.form.submit()" {% if pricerate == 90 %}checked{% endif %}>90
        </label>
        <input type="hidden" name="action" value="set_pricerate">
    </form>

    <!-- ‚úÖ ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÅ‡∏ó‡∏á -->
    <form method="POST" class="bet-type-buttons disable-on-close">
        {% for btype in ["2 ‡∏ï‡∏±‡∏ß", "3 ‡∏ï‡∏±‡∏ß", "6 ‡∏Å‡∏•‡∏±‡∏ö"] %}
            <button class="btn-type {% if btype == bet_type %}selected{% endif %}" type="submit" name="bet_type" value="{{ btype }}">{{ btype }}</button>
        {% endfor %}
        <input type="hidden" name="action" value="set_bet_type">
    </form>

    <!-- ‚úÖ ‡πÉ‡∏™‡πà‡πÄ‡∏•‡∏Ç‡πÄ‡∏ö‡∏¥‡πâ‡∏•/‡∏ï‡∏≠‡∏á -->
    <form method="POST" class="disable-on-close">
        <button class="btn-type {% if double_mode %}selected{% endif %}" type="submit" name="action" value="toggle_double">‡πÉ‡∏™‡πà‡πÄ‡∏•‡∏Ç‡πÄ‡∏ö‡∏¥‡πâ‡∏•/‡∏ï‡∏≠‡∏á</button>
    </form>

    <!-- ‚úÖ ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç -->
    <form method="POST" class="disable-on-close">
        <label>‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç:</label>
        <input type="text" name="numbers_input" placeholder="‡πÄ‡∏ä‡πà‡∏ô 123456" required>
        <button type="submit" name="action" value="add_number">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏Ç</button>
    </form>

    <!-- ‚úÖ ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡∏á -->
    <div class="number-buttons">
        {% for num in numbers %}
        <form method="POST" style="display:inline;" class="disable-on-close">
            <input type="hidden" name="delete_idx" value="{{ loop.index0 }}">
            <button type="submit" name="action" value="delete_number" class="number-btn">
                {{ num }}
            </button>
        </form>
        {% endfor %}
    </div>

    <!-- ‚úÖ ‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏Ñ‡∏≤ -->
    <form method="POST" class="disable-on-close">
        {% if bet_type == "2 ‡∏ï‡∏±‡∏ß" %}
            <label>‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏Ñ‡∏≤:</label>
            <input type="number" name="price_top" value="{{ price_top }}" placeholder="‡∏ö‡∏ô">
            <input type="number" name="price_bottom" value="{{ price_bottom }}" placeholder="‡∏•‡πà‡∏≤‡∏á">
        {% else %}
            <label>‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏Ñ‡∏≤:</label>
            <input type="number" name="price_top" value="{{ price_top }}" placeholder="‡∏ï‡∏£‡∏á">
            <input type="number" name="price_tod" value="{{ price_tod }}" placeholder="‡πÇ‡∏ï‡πä‡∏î">
        {% endif %}
        <button type="submit" name="action" value="add_bill">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏¥‡∏•</button>
    </form>

    <!-- ‚úÖ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏ö‡∏¥‡∏• -->
    <div class="bill-summary">
        {{ bill_html|safe }}
    </div>

    <!-- ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡πà‡∏ß‡∏¢‡∏à‡∏≥ -->
    <form method="POST" class="form-grid">
        <label>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡πà‡∏ß‡∏¢‡∏à‡∏≥:</label>
        <input type="text" name="memo" value="{{ memo }}" oninput="autoSaveMemo(this.value)">
        <input type="hidden" name="action" value="set_memo" id="memo-action">
    </form>

    <script>
    function autoSaveMemo(value) {
        fetch("/", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: new URLSearchParams({
                "action": "set_memo",
                "memo": value
            })
        });
    }

    let secondsLeft = {{ countdown_seconds }};
    const countdownEl = document.getElementById("countdown");
    const disableForms = document.querySelectorAll(".disable-on-close");

    function updateCountdown() {
        if (secondsLeft <= 0) {
            countdownEl.textContent = "‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡πÇ‡∏û‡∏¢‡πÅ‡∏•‡πâ‡∏ß";
            disableForms.forEach(f => f.querySelectorAll("input,button").forEach(el => el.disabled = true));
            return;
        }
        const d = Math.floor(secondsLeft / 86400);
        const h = Math.floor((secondsLeft % 86400) / 3600);
        const m = Math.floor((secondsLeft % 3600) / 60);
        const s = secondsLeft % 60;
        countdownEl.textContent = `‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤: ${d} ‡∏ß‡∏±‡∏ô ${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
        secondsLeft--;
        setTimeout(updateCountdown, 1000);
    }
    updateCountdown();
    </script>

    <!-- ‚úÖ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° -->
    <div class="total-display">
        ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: {{ total_amount }} ‡∏ö‡∏≤‡∏ó
    </div>

    <!-- ‚úÖ ‡∏õ‡∏∏‡πà‡∏°‡∏•‡πâ‡∏≤‡∏á/‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å -->
    <form method="POST" class="form-buttons disable-on-close">
        <button type="submit" name="action" value="clear_input" class="btn-red">üßπ ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á</button>
        <button type="submit" name="action" value="save_all" class="btn-green">üì• ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏û‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    </form>
</div>
</body>
</html>
